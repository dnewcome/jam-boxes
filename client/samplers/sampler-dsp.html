<!doctype html>
<html>
	<head>
		<script src="../lib/dsp.js" type="text/javascript"></script>
		<script>
      var sampleRate = 44100;
      var bufferSize = 1024;
      var bufferTime = Math.floor(1000 / (sampleRate / bufferSize));
      
      var amplitude  = 0.1; // Default amplitude at 70%

      var oct = 3; // Root Octave

      var oscs = [];
      var noteOn = [];
      var playSample = false;
			
			  var s = new Sampler('../audio/cymbal-hihat-stick.wav', bufferSize, sampleRate);
			  s.envelope = new ADSR(0, 0, 1, Infinity, 0, sampleRate);
			  s.envelope.disable(); // turn off so it does not auto trigger

			var interval;

			function stop() {
				clearInterval( interval );
			}

			function start() {	
				var audio = new Audio();
				audio.mozSetup(1, 44100);

				interval = setInterval( function() { 
					  s.generate();
					  var additiveSignal = s.applyEnvelope();
					var samples = audio.mozWriteAudio( additiveSignal );	
					console.log( samples );
				}, 250 );
			}
			function trigger() {
			  s.envelope.noteOn();
			  s.setFreq(440);
			  setTimeout( function() { 
				s.envelope.noteOff(); 
				s.reset();
				console.log('noteOff');
				}, 1000 );
			}

		</script>
	</head>
	<body>
		<button onclick="start();">Start</button>
		<button onclick="stop();">Stop</button>
		<button onclick="trigger();">Trigger</button>
	</body>
</html>
